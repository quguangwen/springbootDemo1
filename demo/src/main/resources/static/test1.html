
<html>
<head>
    <meta charset="UTF-8">
    <title>修改进件状态</title>
    <link rel="stylesheet" href="../static/layui/css/layui.css">
    <script type="text/javascript" src="../static/layui/layui.js"></script>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
</head>
<body>
<script type="text/javascript", scr="../static/js/showAppFinupTable.js"></script>
<script type="text/javascript", scr="../static/js/showTable.js"></script>
<script type="text/javascript", scr="../static/js/sub.js"></script>
<div class="layui-collapse">
    <div class="layui-colla-item">
        <h2 class="layui-colla-title">附件状态修改</h2>
        <div class="layui-colla-content layui-show">
            <!--<form id="attachform" class="layui-form" action="/updateAsset" method="get">-->
            <form id="formAttachment" class="layui-form" onsubmit="return false" action="##" method="post">
                <div class="layui-form-item">
                    <label class="layui-form-label">输入手机号:</label>
                    <div class="layui-input-block">
                        <input type="text" name="mobile" required  lay-verify="required" placeholder="请输入手机号" autocomplete="off" class="layui-input" style="width:200px">
                    </div>
                </div>


                <div class="layui-form-item">
                    <div class="layui-form-item">
                        <label class="layui-form-label">进件附件项:</label>

                        <div class="layui-input-block" style="width:200px">
                            <select id="product" name="product" lay-verify="required" lay-filter="product_name">
                                <option value ="">请选择产品</option>
                            </select>
                            <br>
                            <select id="type" name="type" lay-verify="required" lay-filter="app_type">
                                <option value ="">请选择附件项</option>
                            </select>
                        </div>
                    </div>
                </div>



                <div class="layui-form-item">
                    <label class="layui-form-label">附件项状态:</label>
                    <div class="layui-input-block" style="width:200px">
                        <select id="status" name="status" lay-verify="required" lay-filter="app_status">
                            <option value ="">请选择状态</option>
                        </select>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button id="attachbutton" class="layui-btn layui-btn-normal" lay-submit lay-filter="formDemo">立即提交</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="layui-colla-item">
        <h2 class="layui-colla-title">进件状态修改</h2>
        <div class="layui-colla-content layui-show">
            <!--<form id="formAppStatus" class="layui-form" action="/updateLendApp" method="get">-->
            <form id="formAppStatus" class="layui-form" onsubmit="return false" action="##" method="post">
                <div class="layui-form-item">
                    <label class="layui-form-label">输入手机号:</label>
                    <div class="layui-input-block">
                        <input type="text" name="mobile"  lay-verify="required" placeholder="请输入手机号" autocomplete="off" class="layui-input" style="width:200px">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">进件状态:</label>
                    <div class="layui-input-block" style="width:200px">
                        <select id="appState" name="state_type" lay-verify="required" lay-filter="app_state">
                            <option value ="">请选择状态</option>

                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button id="appstatus" class="layui-btn layui-btn-normal" lay-submit lay-filter="formDemo">立即提交</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="layui-colla-item">
        <h2 class="layui-colla-title">清空钢铁侠设备</h2>
        <div class="layui-colla-content layui-show">
            <!--<form class="layui-form" action="/clearDeviceToken" method="POST">-->
            <form id="formDevice" onsubmit="return false" action="##" method="post">
                <div class="layui-form-item">
                    <label class="layui-form-label">清空设备:</label>
                    <div class="layui-input-block">
                        <input type="text" name="saleID" placeholder="请输入销售工号或者不输入" autocomplete="off" class="layui-input" style="width:200px">
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button id="device" class="layui-btn layui-btn-normal" lay-submit>立即提交</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="layui-colla-item">
        <h2 class="layui-colla-title">查询身份证手机号加密</h2>
        <div class="layui-colla-content layui-show">
            <form id="mcform"  onsubmit="return false" action="##" method="post">
                <div class="layui-form-item">
                    <label class="layui-form-label">请输入:</label>
                    <div class="layui-input-block">
                        <input id ="mcArray" type="text" name="array" placeholder="请输入手机号或者身份证号" autocomplete="off" class="layui-input" style="width:200px">
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button id="submc" class="layui-btn layui-btn-normal" lay-submit lay-filter="formDemo">立即提交</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="layui-colla-item">
        <h2 class="layui-colla-title">查询APP进件信息</h2>
        <div class="layui-colla-content layui-show">
            <!--<form class="layui-form" action="/clearDeviceToken" method="POST">-->
            <form id="appForm" onsubmit="return false" action="##" method="post">
                <div class="layui-form-item">
                    <label class="layui-form-label">请输入:</label>
                    <div class="layui-input-block">
                        <input type="text" name="mobile" placeholder="请输入手机号" autocomplete="off" class="layui-input" style="width:200px">
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button id="appSub" class="layui-btn layui-btn-normal" lay-submit>立即提交</button>
                    </div>
                </div>

                <div style="margin: 10px 50px 50px 50px">
                    <table class="layui-hide" id="appFinupTable"></table>
                </div>
            </form>
        </div>
    </div>

    <div class="layui-colla-item">
        <h2 class="layui-colla-title">查询销售绑定进件</h2>
        <div class="layui-colla-content layui-show">
            <!--<form class="layui-form" action="/clearDeviceToken" method="POST">-->
            <form id="formuser" onsubmit="return false" action="##" method="post">
                <div class="layui-form-item">
                    <label class="layui-form-label">销售工号:</label>
                    <div class="layui-input-block">
                        <input type="text" name="saleno" placeholder="请输入销售工号或者不输入" autocomplete="off" class="layui-input" style="width:200px">
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button id="salesub" class="layui-btn layui-btn-normal" lay-submit>立即提交</button>
                    </div>
                </div>
            </form>
            <div style="margin: 10px 50px 50px 50px">
                <table class="layui-hide" id="customertable"></table>
            </div>
        </div>
    </div>





</div>
<script>

layui.use('element', function(){})
layui.use('form', function(){})

'use strict';
$(function(){

    loadProductList();
    loadProAttach();
    // loadSelectAttachement();
    loadSelectAppState();
    loadSelectAttachmentState();
    sub("#device","#formDevice","/clearDeviceToken");
    sub("#appstatus","#formAppStatus","/updateLendApp");
    sub("#attachbutton","#formAttachment","/updateAsset");
    sub("#submc","#mcform","/getEncrStr");
    showTable("#salesub","#formuser","/getCustomer");
    showAppFinupTable("#appSub","#appForm","/getAppFinupInfor");


})



var sub = function(buttonName, formName, url){
     $(buttonName).click(function(){
       $.ajax({
        type: "POST",
        url: url,
        data: $(formName).serialize(),
        dataType: "json",
        success: function(data){
           alert("code: " + data.code + "," + "message: " + data.message + "," + "result: " + data.result );
        },
        error : function() {
        alert("异常！");
        }
         });
    })
}

var showAppFinupTable = function(buttonName, formName, url){
        $(buttonName).click(function(){
            $.ajax({
               type: "POST",
                url: url,
                data: $(formName).serialize(),
                dataType: "json",
                success: function(data){
                     var result = data.result;
                      layui.use('table', function(){
                        var table = layui.table;
                        table.render({
                        elem: '#appFinupTable'
                                ,cellMinWidth: 80
                                ,data:result
                                ,page:true
                                ,cols: [[
                                  {field:'id',width:'10%', title: '个贷系统ID', sort: true}
                                  ,{field:'app_lend_request_id', width:120, title: 'APP进件ID'}
                                  ,{field:'lend_customer_id', width:180, title: '个贷系统客户ID'}
                                  ,{field:'state_type', width:'30%', title: 'APP状态'}
                                  ,{field:'status', title: '个贷状态'}

                                ]]
                                });
                                });
                },
                error : function() {
                        alert("异常！");ID
                        }
                         });

    })
}

var showTable = function(buttonName, formName, url){
    $(buttonName).click(function(){
       $.ajax({
        type: "POST",
        url: url,
        data: $(formName).serialize(),
        dataType: "json",
        success: function(data){

           var result = data.result;
           layui.use('table', function(){
            var table = layui.table;
            table.render({
            elem: '#customertable'
            ,cellMinWidth: 80
            ,data:result
            ,page:true
            ,cols: [[
              {field:'id',width:80, title: 'ID', sort: true}
              ,{field:'sales_no', width:80, title: '销售工号'}
              ,{field:'customer_name', width:120, title: '用户名'}
              ,{field:'mobile', width:'20%', title: '手机号'}
              ,{field:'id_no',width:'20%', title: '身份证'}
              ,{field:'product_name', width:120, title: '产品名'}
              ,{field:'state_type', title: '状态'}
            ]]
            });
            });

        },
        error : function() {
        alert("异常！");
        }
         });
    })
}

var loadSelectAppState = function(){
    $.ajax({
        type: "GET",
        url: "/getAppStateItem",
        dataType: "json",
        success: function(data){
            layui.use('form', function(){
                var form = layui.form;
                var result = data.result;
                var server = document.getElementById("appState");
                for(var p in result){
                    var option = document.createElement("option");
                    option.setAttribute("value",result[p]); // 给option的value添加值
                    option.innerText=p;     // 打印option对应的纯文本
                    server.appendChild(option);           //给select添加option子标签
                    form.render('select');       // 刷性select，显示出数据
                }
            })

        }

    })
}


var loadSelectAttachmentState = function(){
     $.ajax({
        type: "GET",
        url: "/getAttachmentStatus",
        dataType: "json",
        success: function(data){
            layui.use('form', function(){
                var form = layui.form;
                var result = data.result;
                var server = document.getElementById("status");
                for(var p in result){
                    var option = document.createElement("option");
                    option.setAttribute("value",result[p]);
                    option.innerText = p;
                    server.appendChild(option);
                    form.render('select');
                }
            })
        }
    })
}

var loadProductList = function(){
    $.ajax({
        type: "GET",
        url: "/getProductList",
        dataType: "json",
        success: function(data){
            layui.use('form',function(){
                var form = layui.form;
                var result = data.result;
                var server = document.getElementById("product");
                for( var p in result){
                    var option = document.createElement("option");
                    option.setAttribute("value",result[p].product_type );
                    option.innerText = result[p].product_name + " : " + result[p].product_type;
                    server.appendChild(option);
                    form.render('select');
                }
            })
        }
    })
}


var loadProAttach = function(){
    layui.use('form',function(){
        var form = layui.form;
        form.on('select(product_name)',function(data){
            $("#type").empty();
            form.render('select');
            console.log(data.value);
            var dataTest = {"product_type":data.value}
            $.ajax({
                type: "POST",
                url: "/getAttachByPro",
                data: dataTest,
                dataType: "json",
                success: function(data){
                    var form = layui.form;
                    var result = data.result;
                    var server = document.getElementById("type");
                    for(var p in result){
                        console.log(result[p].material_type);
                        var option = document.createElement("option");
                        option.setAttribute("value",result[p].material_type);
                        option.innerText = result[p].material_name;
                        server.appendChild(option);
                        form.render('select');
                    }
                }
            })
        })
    })
}

</script>

</body>
</html>



